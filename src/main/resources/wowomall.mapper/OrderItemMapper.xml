<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xmu.wowoto.wowomall.mapper.OrderItemMapper">

    <insert id="addOrderItems" parameterType="java.util.List" useGeneratedKeys="true" keyProperty="id">
        insert into order_item(
            order_id, item_type, status, number, price, deal_price, product_id, goods_id, name_with_specifications, gmt_create, gmt_modified, is_deleted
        )
        values
        <foreach collection="list" item="item" separator=",">
            (#{item.orderId}, #{item.itemType}, #{item.statusCode}, #{item.number}, #{item.price}, #{item.dealPrice}, #{item.productId}, #{item.goodsId}, #{item.nameWithSpecifications}, now(), #{item.gmtModified}, 0)
        </foreach>
    </insert>

    <select id="getOrderItemsByOrderId" parameterType="Integer" resultType="OrderItem">
        select id,
               order_id,
               itemType,
               status_code,
               `number`,
               price,
               deal_price,
               product_id,
               goods_id,
               nameWithSpecifications,
               picUrl,
               gmt_create,
               gmt_modified.
        from order_item
        where order_id = #{orderId} and be_deleted = 0
    </select>

    <select id="updateOrderItemSelective" parameterType="OrderItem" resultType="Integer">
        update order_item
        <set>
            <if test="orderId != null">
                order_id = #{orderId},
            </if>
            <if test="itemType != null">
                item_type = #{itemType},
            </if>
            <if test="statusCode != null">
                statusCode = #{status},
            </if>
            <if test="number != null">
                `number` = #{number},
            </if>
            <if test="price != null">
                price = #{price},
            </if>
            <if test="dealPrice != null">
                deal_price = #{dealPrice},
            </if>
            <if test="productId != null">
                product_id= #{productId},
            </if>
            <if test="goodId != null">
                goods_id = #{goodId},
            </if>
            <if test="nameWithSpecifications != null">
                name_with_specifications = #{nameWithSpecifications},
            </if>
            <if test="gmtCreate != null">
                gmt_create = #{gmtCreate},
            </if>
            <if test="gmtModified != null">
                gmt_modified = now(),
            </if>
            <if test="beDeleted != null">
                is_deleted = #{beDeleted},
            </if>
        </set>
        where id = #{id}
    </select>

    <select id="getOrderItemById" parameterType="Integer" resultType="OrderItem">
               select id,
                   order_id,
                   itemType,
                   status_code,
                   `number`,
                   price,
                   deal_price,
                   product_id,
                   goods_id,
                   nameWithSpecifications,
                   picUrl,
                   gmt_create,
                   gmt_modified.
        from order_item
        where id = #{orderItemId} and be_deleted = 0
    </select>

    <select id="getOrderItemByStatus"  resultType="OrderItem">
               select id,
                   order_id,
                   itemType,
                   status_code,
                   `number`,
                   price,
                   deal_price,
                   product_id,
                   goods_id,
                   nameWithSpecifications,
                   picUrl,
                   gmt_create,
                   gmt_modified.
        from order_item
        where id = #{orderItemId} and be_deleted = 0
    </select>
</mapper>